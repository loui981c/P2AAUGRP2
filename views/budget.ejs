<%- include ("partials/header.ejs") %>


<body>
  
  <%# calculate total spent %>
  <%# calculate total remaining %>
  <%# calculate total Remaining %>
  <%# calculate total Available From amount of income this could also be done throgh expected values %>
    <%- include ("partials/sidebar.ejs") %>

    <% 
    let totalSpent = 0;
    for (let i = 0; i<budgetData.length; i++){
        if (budgetData[i].category!= "income")
        {
          totalSpent += budgetData[i].spent;
        }
      } 
    
    let totalRemaining = 0;
    let totalAvailable = 0;
    let totalIncome = 0;
    let totalExpected = 0;

      for (let j = 0; j < budgetData.length; j++)
      {
          if (budgetData[j].category == "income")
          {   
              totalIncome = budgetData[j].spent;

              totalAvailable += budgetData[j].spent ;
            }
            else{
              totalExpected += budgetData[j].expected;
            }
      }
      totalRemaining = totalAvailable - totalSpent;


      let expectedRemaining = totalIncome - totalExpected;
    %> 

    <div class="budgetPage">
      <h1>Budget</h1>

      <%# add budget %>
      <div class="addBudget">
        <a href="/budget/add"><button class="addBudgetBut">Add Budget/Create Category</button></a>
      </div>
      <!-- <%# Expected %>
      <h2>Expected remaining</h2>
      <div class="totalAmountBox">
        <div class="totalIncomebox">
          <p>Total Income:</p>
          <p class="" id="spentGreen">+<%= totalIncome %></p>
          <p class="">Kr.</p>
        </div>
        <div class="totalAmountSpent">
        <p class="totalAmount">Total Expected:</p>
        <div class="totalSpentBox">
          <p class="numTotal" id="spentRed">-<%= totalExpected %></p>
          <p class="numTotalKr">Kr.</p>
        </div>
      </div>
        <div class="totalAmountRemaining">
          <p class="totalAmount">Total Remaining:</p>
            <div class="totalRemainingBox">
              <% if(totalRemaining < 0){ %>
              <p class="numTotal" id="remainingRed"> <%= expectedRemaining %></p>
              <% } else{ %>  
              <p class="numTotal" id="remainingGreen"> +<%= expectedRemaining %></p>
              <% } %>
              <p class="numTotalKr">Kr.</p>
            </div>
        </div>
      </div> -->
      

      <%# total amounts %>
      <!-- <h2>Actual remaining</h2> -->
      <!-- <div class="totalAmountBox">
          <div class="totalIncomebox">
            <p>Total Income:</p>
            <p class="" id="spentGreen">+<%= totalIncome %></p>
            <p class="">Kr.</p>
          </div>
          <div class="totalAmountSpent">
          <p class="totalAmount">Total Spent:</p>
          <div class="totalSpentBox">
            <p class="numTotal" id="spentRed">-<%= totalSpent %></p>
            <p class="numTotalKr">Kr.</p>
          </div>
        </div>
          <div class="totalAmountRemaining">
            <p class="totalAmount">Total Remaining:</p>
              <div class="totalRemainingBox">
                <% if(totalRemaining < 0){ %>
                <p class="numTotal" id="remainingRed"> <%= totalRemaining %></p>
                <% } else{ %>  
                <p class="numTotal" id="remainingGreen"> +<%= totalRemaining %></p>
                <% } %>
                <p class="numTotalKr">Kr.</p>
              </div>
          </div>
        </div> -->


      <%# Total Table %>
      <table class="totalTable">
       
        
        <tr>
          <th>Total Expected:</th>
          <td><%= totalExpected %></td>
          <td class="valuta">kr.</td>
        </tr>
        <tr>
          <th>Total Income:</th>
          <td class="pos">+<%= totalIncome %></td>
          <td class="valuta">kr.</td>
        </tr>
        <tr>
          <th>Total Spent:</th>
          <td class="neg">-<%= totalSpent %></td>
          <td class="valuta">kr.</td>
        </tr>
        <tr>
          <th>Total Remaining:</th>
          <% if(totalRemaining < 0){ %>
          <td class="neg"><%= totalRemaining %></td>
          <td class="valuta">kr.</td>
          <% } else{ %>
            
          <td class="pos">+<%= totalRemaining %></td>
          <td class="valuta">kr.</td>
            <% } %>
        </tr>
     
      </table>


    
      <%# Showing the labels %>
        <div class="budgetLabels">
            <p class="category">Category</p>
            <p class="expected">Expected</p>
            <p class="spent">Spent</p>
            <p class="remaining">Remaining</p>
        </div>
      
      <%# Showing the budget in the table %>
        
      <% for (let i = 0; i<budgetData.length; i++){ %> 

        <% if (budgetData[i].category != "income"){ %> 
        <div class="budgetTable">
            <div class="budgetInsideTable">
              <p class="budgetCategory"><%= budgetData[i].category %></p>
              <div class="KrInline">
                  <p class="budgetExpected"><%= budgetData[i].expected %></p>
                  <p class="Kr">Kr.</p>
              </div>
              <div class="KrInline">
                <% if(budgetData[i].category.toLowerCase() === 'income'){ %>
                  <p class="budgetRemaining" id="spentTableGreen"> +<%= budgetData[i].spent %></p>
                  <p class="Kr">Kr.</p>
                  <% } else{ %>  
                  <p class="budgetRemaining" id="spentTableRed"> -<%= budgetData[i].spent %></p>
                  <p class="Kr">Kr.</p>
                  <% } %>
              </div>
              <div class="KrInline">
                <% if(budgetData[i].remaining < 0){ %>
                <p class="budgetRemaining" id="remainingTableRed"> <%= budgetData[i].remaining %></p>
                <p class="Kr">Kr.</p>
                <% } else{ %>  
                <p class="budgetRemaining" id="remainingTableGreen"> +<%= budgetData[i].remaining %></p>
                <p class="Kr">Kr.</p>
                <% } %>
              </div>
            </div>

            <div class="editBudgetBoxParent">
              <div class="editBudgetBox">
                <a href="/budget/<%= budgetData[i]._id %>/edit"><button class="editBudget">Edit</button></a>
                <form method="POST" action="/budget/<%= budgetData[i]._id %>/delete">
                <button class="deleteBudget">Delete</button>
                </form>
              </div>
            </div>
          </div>
        <% } %> 
      <% } %> 
      
    </div>
  </body>
</html>