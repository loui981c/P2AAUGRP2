<%- include ("partials/header.ejs") %>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
    <body>
        <%- include ("partials/sidebar.ejs") %>
        <div class="monthlyPage">
            <h1>Monthly Overview</h1>
                <div class="chooseGraph">
                <%# Dropdown for choosing graph type%>
                    <label for="graphs">Choose Graph</label>
                    <select name="graphs" id="graphs" onchange="changeChart(this)">
                        <option value="doughnut">Pie Chart</option>
                        <option value="bar">Bar Chart</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class ="chart_edit">
            <canvas id="myChart"></canvas>
            <%# Does nothing for appearance but is a workaround for transfering serverside date to script %> 
            <div id="categoriesTransferNames" ><%= categories %></div>
            <div id="categoriesTransferPrices" ><%= sumOfPrices %></div>
            <script>
                //getting inner html and making it invisible
                    //cat labels
                    document.getElementById("categoriesTransferNames").style.display = "none"
                    let transferedCats = document.getElementById("categoriesTransferNames").innerHTML;
                    let catLabels = transferedCats.split(",")

                    //cat prices
                    document.getElementById("categoriesTransferPrices").style.display = "none"
                    let transferedPrices = document.getElementById("categoriesTransferPrices").innerHTML;
                    let catPrices = transferedPrices.split(",")



                  
                    
                    console.log(catLabels);
                    console.log(catPrices);


                const data = {
                    labels: catLabels,
                    datasets: [{
                        label: 'Expenses',
                        data: catPrices,
                        backgroundColor: [
                        'red',
                        'yellow',
                        'blue',
                        'green',
                        'purple',
                        'rgba(0, 0, 0, 1)',
                        'rgba(255, 159, 64, 1)'
                        ]
                    }]
                };

                // config for dougnut chart
                const config = {
                    type: 'doughnut',
                    data,
                    options: {
                    }
                };

                //config for bar chart
                const config1 = {
                    type: 'bar',
                    data,
                    options: {
                        scales: {
                        y: {
                            beginAtZero: true
                        }
                        }
                    }
                };

                // render init block
                let myChart = new Chart(
                document.getElementById('myChart'),
                config
                );

                function changeChart(chartType){
                    myChart.destroy();

                    if (chartType.value === 'doughnut'){
                        myChart = new Chart(
                            document.getElementById('myChart'),
                            config
                        )
                    }

                    if (chartType.value === 'bar'){
                        myChart = new Chart(
                            document.getElementById('myChart'),
                            config1
                        )
                    }
                }
            </script>
        </div>
    </body>
</html>